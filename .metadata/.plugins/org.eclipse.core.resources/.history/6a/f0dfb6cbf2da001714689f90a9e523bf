package com.cioclass.util.or;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.util.List;
import java.util.Set;
import java.util.UUID;
import com.google.common.collect.Lists;
import com.google.common.collect.Sets;
public class QrcodeBuilder4XS implements IQrcodeBuilder{
	
	/**
	 * 2位商家码+2位批号码+1个空格+6位流水码前3位+空格+6位流水码后3位+逗号+网址前缀+参数+2位商家码+2位批号码+8位防伪码
	 * =25字符+网址长度(参数为 ?n=)
	 * =46字符(http://cioclass.com/o)
	 */
	@Override
	public List<String> createContent(String en, String bn, String url, int size, int num) {
		Set<String> set = getSet(size, num);
		List<String> list = Lists.newArrayList();
		StringBuilder sb = null;
		int i = 1;
		for (String s : set) {
			sb = new StringBuilder();
			sb = sb.append(en).append(bn).append(" ").append(getNumStr(i, 6))
					.append(",").append(url).append("?n=").append(en).append(bn).append(s);
			list.add(sb.toString());
			i++;
		}
		return list;
	}
	
	@Override
	public String getNumStr(int no, int size) {
		String ns = String.format("%0"+size+"d", no);
		return ns.substring(0, 3)+" "+ns.substring(3);
	}

	@Override
	public Set<String> getSet(int size, int num) {
		Set<String> set = Sets.newHashSet();
		int count = 0;
		while (count < num) {
			if (set.add(UUID.randomUUID().toString().replace("-", "").substring(0, size))) {
				count++;
			}
		}
		return set;
	}
	
	List<String> ReadFileContents(String fileName) {
		List<String> list = Lists.newArrayList();
		File f = new File(fileName);
		if (!f.isDirectory()) {
			if (!f.canRead()) {
				f.setReadable(true);
			}
			try (FileReader fr = new FileReader(f); BufferedReader read = new BufferedReader(fr);) {
				String s = null;
				while((s = read.readLine())!= null) {
					list.add(s);
				}
			} catch (FileNotFoundException e) {
				LOG.error(e.getMessage());
				return null;
			} catch (IOException e) {
				LOG.error(e.getMessage());
				return null;
			}
		} else {
			LOG.error(fileName +"是一个目录！");
			return null;
		}
		return list;
	}
}
